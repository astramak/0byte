# 0byte nginx config

upstream 0byte {
	server 127.0.0.1:9000;
}

server {
	server_name 0byte;

	root /home/Projects/0byte;

  # deny access to htaccess
	location ~ /\.ht {
		return 404;
		break;
	}

	location / {
		index index.php;
	
		rewrite ^talks/ index.php?blog=174 last;
		rewrite /talks/from/([0-9]*) index.php?blog=174&frm=$1 last;
		
		rewrite /loolz all.php?wt=loolz last;
   
		rewrite /refer/([^\/]*) refer.php?who=$1 last;
		
		rewrite /all/([^\/]*) all.php?wt=$1 last;
		
		rewrite /post/([0-9]*)/from/([0-9]*) index.php?post=$1&frm=$2 last;
		rewrite /post/([0-9]*) index.php?post=$1 last;

		rewrite /blog/([0-9]*)/from/([0-9]*) index.php?blog=$1&frm=$2 last;
		rewrite /blog/([0-9]*) index.php?blog=$1 last;
	
		rewrite /list/user/banned/from/([0-9]*) all.php?wt=userl&banned=1&from=$1 last;
		rewrite /list/user/banned all.php?wt=userl&banned=1 last;
		rewrite /list/user/city/([^\/]*)/from/([0-9]*) all.php?wt=userl&city=$1&from=$2 last;
		rewrite /list/user/city/([^\/]*)/([^\/]*)/from/([0-9]*) all.php?wt=userl&city=$1&order=$2&from=$3 last;
		rewrite /list/user/city/([^\/]*)/([^\/]*) all.php?wt=userl&city=$1&order=$2 last;
		rewrite /list/user/city/([^\/]*) all.php?wt=userl&city=$1 last;
		rewrite /list/user/from/([0-9]*) all.php?wt=userl&from=$1 last;
		rewrite /list/user/([^\/]*)/from/([0-9]*) all.php?wt=userl&order=$1&from=$2 last;
		rewrite /list/user/([^\/]*) all.php?wt=userl&order=$1 last;
		rewrite /list/user all.php?wt=userl last;
		rewrite /list/blog/from/([0-9]*) all.php?wt=blogs&from=$1 last;
		rewrite /list/blog/([^\/]*)/from/([0-9]*) all.php?wt=blogs&order=$1&from=$2 last;
		rewrite /list/blog/([^\/]*) all.php?wt=blogs&order=$1 last;
		rewrite /list/blog all.php?wt=blogs last;
		rewrite /list/city/from/([0-9]*) all.php?wt=city&from=$1 last;
		rewrite /list/city/([^\/]*)/from/([0-9]*) all.php?wt=city&order=$1&from=$2 last;
		rewrite /list/city/([^\/]*) all.php?wt=city&order=$1 last;
		rewrite /list/city all.php?wt=city last;

		rewrite /comment/([^\/]*)/from/([0-9]*) comments.php?who=$1&frm=$2 last;
		rewrite /comment/([^\/]*) comments.php?who=$1 last;

		rewrite /work/newpost worked.php?wt=newpost last;
		rewrite /work/newpost/answ/([0-9]*) worked.php?wt=newpost&tp=answ&len=$1 last;
		rewrite /work/editpost/([0-9]*) worked.php?wt=editpost&post=$1 last;
		rewrite /work/editcom/([0-9]*) worked.php?wt=editcom&id=$1 last;
		rewrite /work/hold/([0-9]*) twork.php?wt=hold&id=$1 last;
		rewrite /work/rmcom/([0-9]*) twork.php?wt=rmcom&id=$1 last;
		rewrite /work/rmblog/([0-9]*) twork.php?wt=killblog&id=$1 last;
		rewrite /work/rmpost/([0-9]*) twork.php?wt=rmpost&id=$1 last;
		rewrite /work/newpost/([^\/]*) worked.php?wt=newpost&tp=$1 last;
		rewrite /work/newblog/ worked.php?wt=newblog last;
		rewrite /work/pmls/out worked.php?wt=pmls&tp=1 last;
		rewrite /work/pmls/ worked.php?wt=pmls last;
		rewrite /work/pmread/([^\/]*) worked.php?wt=pmread&id=$1 last;
		rewrite /work/pmnew/([^\/]*)/([^\/]*) worked.php?wt=pmnew&name=$1&title=$2 last;
		rewrite /work/pmnew/([^\/]*) worked.php?wt=pmnew&name=$1 last;
		rewrite /work/pmnew/ worked.php?wt=pmnew last;
		rewrite /work/comment/([^\/]*)/([^\/]*)/(.*) worked.php?wt=comment&id=$1&lvl=$2&cur=$3 last;
		rewrite /work/block/([^\/]*)/([^\/]*) worked.php?wt=block&type=$1&name=$2 last;
		rewrite /work/blockpost/([0-9]*)/1 worked.php?wt=bpost&id=$1&json=1 last;
		rewrite /work/blockpost/([0-9]*) worked.php?wt=bpost&id=$1 last;
		rewrite /work/editblog/([0-9]*) worked.php?wt=myblog&id=$1&single=1 last;
		rewrite /work/([^\/]*) worked.php?wt=$1 last;
		rewrite /work/delete_user/error worked.php?wt=delete_user&error=1 last;

		rewrite /from/([0-9]*)/(.*) index.php?frm=$1&fnd=$2 last;
		rewrite /from/([0-9]*) index.php?frm=$1 last;

		rewrite /user/([^\/]*) users.php?name=$1 last;
		
		rewrite /tag/(.*)/from/([0-9]*) index.php?tag=$1&frm=$2 last;
		rewrite /lenta/from/([0-9]*) worked.php?wt=lenta&frm=$1 last;
		rewrite /main/from/([0-9]*) index.php?pg=main&frm=$1 last;
		rewrite /pers/from/([0-9]*) index.php?pg=pers&frm=$1 last;
		rewrite /tag/(.*) index.php?tag=$1 last;
		rewrite /tags all.php?wt=tags last;

		rewrite /auth/(.*)/from/([0-9]*) index.php?auth=$1&frm=$2 last;
		rewrite /auth/([^\/]*) index.php?auth=$1 last;
		
		rewrite /login/new login.php?new=1 last;
		rewrite /login/(.*) login.php?cur=$1 last;
		rewrite /login login.php last;
  
		rewrite /main index.php?pg=main last;
		rewrite /pers index.php?pg=pers last;
		rewrite /lenta worked.php?wt=lenta last;
		rewrite /register register.php last;

		rewrite /rss/blog/(.*) rss.php?blog=$1 last;
		rewrite /rss/auth/(.*) rss.php?auth=$1 last;
		rewrite /rss/lenta/(.*) rss.php?lenta=$1 last;
		rewrite /rss/pers rss.php?pg=pers last;
		rewrite /rss/main rss.php?pg=main last;
		rewrite /rss rss.php last;

		rewrite /draft/([0-9]*) worked.php?wt=editpost&post=$1&draft=1 last;
		rewrite /draft/from/([0-9]*) index.php?draft=1&from=$1 last;
		rewrite /draft index.php?draft=1 last;

		rewrite /favourite index.php?favourite=1 last;
		rewrite /like/([0-9]*) index.php?like=$1 last;
		rewrite /error/(.*) all.php?wt=error&err=$1 last;

		rewrite /ajax/code/(.*) index.php?ajax=autocomplete&code=1&query=$1 last;
		rewrite /ajax/tag/(.*) index.php?ajax=autocomplete&tag=1&query=$1 last;
		rewrite /ajax/(.*) index.php?ajax=$1 last;
	}

	# static files
	location ~* \.(jpg|gif|jpeg|png|js|css)$ {
		access_log off;
		expires 1d;
	}

	location ~\ *.php {
		charset utf8;

		include       /etc/nginx/conf/fastcgi_params;

		fastcgi_index  index.php;
		fastcgi_param  DOCUMENT_ROOT    /home/Projects/0byte/;
		fastcgi_param  SCRIPT_FILENAME  /home/Projects/0byte/$fastcgi_script_name;
		fastcgi_pass   0byte;

		include        /etc/nginx/conf/fastcgi_params;
	}
}
